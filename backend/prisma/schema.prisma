generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
  extensions = [vector]
}

model User {
  id           String     @id @default(uuid())
  email        String     @unique
  passwordHash String
  createdAt    DateTime   @default(now())
  
  documents    Document[]
  feedbacks    Feedback[]
}

enum DocStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model Document {
  id           String      @id @default(uuid())
  userId       String
  user         User        @relation(fields: [userId], references: [id])
  
  filename     String
  originalName String
  mimeType     String
  
  status       DocStatus   @default(PENDING)
  

  // Eg: { "summary": "...", "tags": ["AI", "Finance"] }
  metadata     Json?       
  
  content      String?     @db.Text // Raw data extracted
  
  embeddings   Embedding[]
  createdAt    DateTime    @default(now())
}

model Embedding {
  id         String   @id @default(uuid())
  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  content    String   @db.Text // Specific text chunk
  

  vector     Unsupported("vector(768)")
  
  createdAt  DateTime @default(now())
  
  
  @@index([documentId])
}

model Feedback {
  id            String   @id @default(uuid())
  userId        String?
  user          User?    @relation(fields: [userId], references: [id])
  
  messageId     String   
  isPositive    Boolean  // true = üëç, false = üëé
  comment       String? 
  
  promptVersion String  
  modelUsed     String   
  
  createdAt     DateTime @default(now())
}

model AuditLog {
  id        String   @id @default(uuid())
  action    String   
  details   String?
  status    String   // "SUCCESS", "FAILURE"
  timestamp DateTime @default(now())
}